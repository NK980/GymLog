<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<title>GymLog</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #111;
    color: white;
    padding: 20px;
}
h1 { text-align: center; }
input {
    padding: 6px;
    margin: 4px;
    border-radius: 6px;
    border: none;
    width: 30px;       /* kleiner */
    text-align: center;
}

select {
    padding: 8px;
    margin: 4px;
    border-radius: 6px;
    border: none;
}
.exercise {
    margin-bottom: 12px;
    padding: 10px;
    background: #1e1e1e;
    border-radius: 8px;
}
button {
    padding: 12px;
    width: 100%;
    background: #2ecc71;
    border: none;
    color: black;
    font-weight: bold;
    border-radius: 8px;
    margin-top: 20px;
}
.previous {
    display: inline-block;
    background: #333;
    color: #aaa;
    padding: 6px 8px;
    border-radius: 6px;
    margin-right: 8px;
    min-width: 90px;
    text-align: center;
}
.setRow {
    margin-bottom: 6px;
}
</style>
</head>
<body>

<h1>GymLog</h1>

<div id="homeScreen">
    <button onclick="showSplitScreen()">Start Workout</button>
    <button onclick="showProgress()" style="background:#3498db;">
        Show Progress
    </button>
    <button onclick="deleteProgress()" style="background:#e67e22;">
        Delete Progress
    </button>
</div>

<div id="splitScreen" style="display:none; margin-top:20px;">
    <button onclick="goBackToHome()" style="background:#555;">
        â¬… Back
    </button>
    <div id="splitButtons"></div>
</div>
<!-- <button onclick="showProgress()" style="background:#3498db; margin-top:10px;">
Show Progress
</button> -->

<!-- 
<button onclick="saveWorkout()">Save Workout</button>

<button onclick="resetData()" style="background:#e74c3c;">
Reset All Data
</button> -->

<div id="chartContainer" style="margin-top:30px;">
    <canvas id="progressChart"></canvas>
</div>

<div id="exerciseList" style="margin-top:20px;"></div>

<div id="workoutScreen" style="display:none;">
    <button onclick="goBack()" style="background:#555;">
        â¬… Back
    </button>

    <div id="workoutContainer"></div>

    <button onclick="saveWorkout()">
        Save Workout
    </button>
</div>


<script>
document.addEventListener("DOMContentLoaded", function() {

const splits = {
"Upper1": ["Benchpress","Incline Benchpress","Pullup","Straight Arm Pulldown","Biceps Curl","Hammer Curl","Skullcrusher","Lateral Raise","Bent Over Rear Delt Fly"],
"Lower1": ["Quads","Lunges","Leg Extension","Romanian Deadlift","Calf Raises"],
"Upper2": ["Lat Pulldown","Barbell Row","Overhead Press","Facepulls","Benchpress","Dumbbell Fly","Preacher Curl","Hammer Curl","Triceps Pushdown","Skullcrusher"],
"Lower2": ["Hip Thrust","Glute Kickback","Hamstring Curls","Goodmornings","Quads","Calf Raise"],
"Upper3": ["Strict Biceps Curl","Concentration Curl","Overhead Press","Lateral Raise","Incline Benchpress","Cable Flies","Meadows Row","Cable Row","Pushdown Triceps"]
};

const splitSelect = document.getElementById("splitSelect");


function cleanId(name) {
    return name.replace(/\s+/g, "_").replace(/[^\w]/g, "");
}

function loadSplitDirect(selected) {

    const container = document.getElementById("workoutContainer");
    container.innerHTML = "";

    let lastWorkout = getLastWorkoutForSplit(selected);

    splits[selected].forEach(ex => {

        let id = cleanId(ex);

        let lastSets = null;

        if (lastWorkout) {
            let found = lastWorkout.exercises.find(e => e.name === ex);
            if (found) {
                lastSets = found.sets;
            }
        }

        let div = document.createElement("div");
        div.className = "exercise";

        div.innerHTML = `
            <strong>${ex}</strong><br><br>

            <div class="setRow">
                <span class="previous">
                    ${lastSets ? lastSets[0].weight + "kg x " + lastSets[0].reps : "-"}
                </span>
                <input type="number" placeholder="kg" id="${id}_w1">
                <input type="number" placeholder="reps" id="${id}_r1">
            </div>

            <div class="setRow">
                <span class="previous">
                    ${lastSets ? lastSets[1].weight + "kg x " + lastSets[1].reps : "-"}
                </span>
                <input type="number" placeholder="kg" id="${id}_w2">
                <input type="number" placeholder="reps" id="${id}_r2">
            </div>

            <div class="setRow">
                <span class="previous">
                    ${lastSets ? lastSets[2].weight + "kg x " + lastSets[2].reps : "-"}
                </span>
                <input type="number" placeholder="kg" id="${id}_w3">
                <input type="number" placeholder="reps" id="${id}_r3">
            </div>

            <br>
            Skip: <input type="checkbox" id="${id}_skip" 
                onchange="toggleSkip('${id}')">
        `;

        container.appendChild(div);
    });

    // Speichern merkt sich aktuellen Split
    window.currentSplit = selected;
}

window.showSplitScreen = function() {

    document.getElementById("homeScreen").style.display = "none";

    document.getElementById("chartContainer").style.display = "none";
    document.getElementById("exerciseList").innerHTML = "";

    const splitDiv = document.getElementById("splitScreen");
    const buttonContainer = document.getElementById("splitButtons");

    splitDiv.style.display = "block";
    buttonContainer.innerHTML = "";

    Object.keys(splits).forEach(splitName => {

        let btn = document.createElement("button");
        btn.textContent = splitName;
        btn.style.marginBottom = "10px";

        btn.onclick = function() {
            startWorkout(splitName);
        };

        buttonContainer.appendChild(btn);
    });
}

window.toggleSkip = function(id) {

    let skipped = document.getElementById(id + "_skip").checked;

    for (let i = 1; i <= 3; i++) {

        let w = document.getElementById(id + "_w" + i);
        let r = document.getElementById(id + "_r" + i);

        if (skipped) {
            w.style.display = "none";
            r.style.display = "none";
        } else {
            w.style.display = "inline-block";
            r.style.display = "inline-block";
        }
    }
}

window.startWorkout = function(splitName) {

    document.getElementById("splitScreen").style.display = "none";
    document.getElementById("workoutScreen").style.display = "block";

    loadSplitDirect(splitName);
}

window.saveWorkout = function() {

    let selected = window.currentSplit;
    if (!selected) {
        alert("Select a workout first");
        return;
    }

    let workoutData = {
        date: new Date().toLocaleString(),
        split: selected,
        exercises: []
    };

    splits[selected].forEach(ex => {

        let id = cleanId(ex);

        workoutData.exercises.push({
            name: ex,
            sets: [
                {
                    weight: document.getElementById(`${id}_w1`).value,
                    reps: document.getElementById(`${id}_r1`).value
                },
                {
                    weight: document.getElementById(`${id}_w2`).value,
                    reps: document.getElementById(`${id}_r2`).value
                },
                {
                    weight: document.getElementById(`${id}_w3`).value,
                    reps: document.getElementById(`${id}_r3`).value
                }
            ],
            skipped: document.getElementById(`${id}_skip`).checked
        });
    });

    let history = JSON.parse(localStorage.getItem("gymLog")) || [];
    history.push(workoutData);
    localStorage.setItem("gymLog", JSON.stringify(history));

    alert("Workout Saved ðŸ’ª");
}

window.showExerciseProgress = function(selectedExercise) {
    
    document.getElementById("exerciseList").innerHTML = "";

    let history = JSON.parse(localStorage.getItem("gymLog")) || [];

    let labels = [];
    let dataPoints = [];

    history.forEach(workout => {

        workout.exercises.forEach(ex => {

            if (ex.name === selectedExercise) {

                let bestSet = 0;

                ex.sets.forEach(set => {
                    let weight = parseFloat(set.weight);
                    let reps = parseFloat(set.reps);

                    if (!isNaN(weight) && !isNaN(reps)) {
                        let volume = weight * reps;
                        if (volume > bestSet) bestSet = volume;
                    }
                });

                if (bestSet > 0) {
                    labels.push(workout.date);
                    dataPoints.push(bestSet);
                }
            }
        });
    });

    if (labels.length === 0) {
        alert("No data for this exercise yet.");
        return;
    }

    const ctx = document.getElementById('progressChart').getContext('2d');

    if (window.myChart) {
        window.myChart.destroy();
    }

    window.myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: selectedExercise + " Progress (Volume = kg x reps)",
                data: dataPoints,
                borderWidth: 3,
                tension: 0.2
            }]
        }
    });
}

window.showProgress = function() {

    document.getElementById("chartContainer").style.display = "block";

    const exerciseListDiv = document.getElementById("exerciseList");
    exerciseListDiv.innerHTML = "";

    let history = JSON.parse(localStorage.getItem("gymLog")) || [];

    if (history.length === 0) {
        alert("No workouts saved yet.");
        return;
    }

    // Alle einzigartigen Ãœbungen sammeln
    let allExercises = new Set();

    history.forEach(workout => {
        workout.exercises.forEach(ex => {
            allExercises.add(ex.name);
        });
    });

    // Buttons erzeugen
    allExercises.forEach(exName => {

        let btn = document.createElement("button");
        btn.textContent = exName;
        btn.style.marginBottom = "8px";
        btn.style.background = "#444";
        btn.style.color = "white";
        

        btn.onclick = function() {
            showExerciseProgress(exName);
        };

        exerciseListDiv.appendChild(btn);
    });
}

window.goBack = function() {

    // Workout Screen ausblenden
    document.getElementById("workoutScreen").style.display = "none";

    // Split Screen ausblenden
    document.getElementById("splitScreen").style.display = "none";

    // Home Screen anzeigen
    document.getElementById("homeScreen").style.display = "block";

    // Workout leeren
    document.getElementById("workoutContainer").innerHTML = "";

    // Progress Liste leeren
    document.getElementById("exerciseList").innerHTML = "";

    // Chart lÃ¶schen
    if (window.myChart) {
        window.myChart.destroy();
    }

    // aktuellen Split zurÃ¼cksetzen
    window.currentSplit = null;
}

window.goBackToHome = function() {

    document.getElementById("splitScreen").style.display = "none";
    document.getElementById("homeScreen").style.display = "block";

}

window.deleteProgress = function() {

    if (confirm("Delete ALL saved workouts?")) {
        localStorage.removeItem("gymLog");

        // Chart entfernen falls sichtbar
        if (window.myChart) {
            window.myChart.destroy();
        }

        document.getElementById("exerciseList").innerHTML = "";
        document.getElementById("chartContainer").style.display = "none";

        alert("Progress deleted.");
    }
}

// window.resetData = function() {
//     if (confirm("Are you sure? This deletes ALL workouts.")) {
//         localStorage.removeItem("gymLog");
//         alert("All data deleted.");
//     }
// }

function getLastWorkoutForSplit(splitName) {

    let history = JSON.parse(localStorage.getItem("gymLog")) || [];

    // rÃ¼ckwÃ¤rts durchgehen (neueste zuerst)
    for (let i = history.length - 1; i >= 0; i--) {
        if (history[i].split === splitName) {
            return history[i];
        }
    }

    return null;
}

});
</script>